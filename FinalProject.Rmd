---
title: "Final Project: World Happiness Index"
author: "Jessica Strait"
date: "4-24-2020"
output: html_notebook
---

## Front Matter

```{r} 
rm(list = ls())

# load packages
library(DataComputing)
library(mosaic)
library(tidyverse)
library(dplyr)
install.packages("party")
library(party)
```

## Guiding Questions

* **Which regions of the world are the happiest and why?**
  + *Which countries have seen a large change in happiness from 2018 to 2019?*
  + *What role does the residual play across countries and continents?*

## Data Access

```{r}
# Import the data sets for years 2018 and 2019
data2018 <- read.csv("C:\\Users\\jessl\\Desktop\\2018.csv")
data2019 <- read.csv("C:\\Users\\jessl\\Desktop\\2019.csv")
```

```{r}
# Import supporting data from R packages
install.packages("countrycode")
library(countrycode)
install.packages("gdata")
library(gdata)
```

```{r}
# Inspect my primary data sources
head(data2018, 5)
tail(data2018, 5)
count(data2018)
names(data2018)
str(data2018)
```


## Data Wrangling

```{r}
# Use a join to merge data from 2018 and 2019. Note that variables with .x are from 2018, and .y are from 2019.
happiness <- merge(data2018, data2019, by = "Country.or.region")
head(happiness, 10)
```

```{r}
# Convert country variable to a string so we can use the countrycode package. Double-check that it worked.
happiness$Country.or.region <- as.character(happiness$Country.or.region)
class(happiness$Country.or.region)
```

```{r}
# Time to start assigning continents to countries! I'll create a new variable using the countrycode package to assign the continents.
happiness <- happiness %>% mutate(Continent = countrycode(sourcevar = happiness$Country.or.region, origin = "country.name", destination = "continent"))
happiness
```

```{r}
# Let's look at some quick stats about our data table for 2018. We will want this information to do some predictions with machine learning.
favstats(~ Score.x, data = happiness)
```

```{r}
# Looking at the 2018 data, let's see how much of a contributing factor the Continent is. We know there are 152 cases by our favstats() function.
# First, turn our Continent variable into a factor so that we can run the ctree() function on it.
happiness$Continent <- as.factor(happiness$Continent)
# Use machine learning techniques from the party R package. We are conditioning on Continent and measuring the probability of a country being in the top 50% of happiest countries.
happy_continents2018 <- ctree(Overall.rank.x < (152/2) ~ Continent, data = happiness)
# Plot the decision tree
plot(happy_continents2018, type = "simple")
```
To read this decision tree, note that n = the number of countries in a node (i.e. a continent) and y = the probability of a country in that node to be in the happiest 50% of countries. Countries in the Americas, Europe, and Oceania have an 81% chance of being in the top 50%, countries in Asia have a 44.5% chance, and countries in Africa have less than a 5% chance. We can tell from this decision tree that simply knowing the continent of a country allows us to make a reasonable prediction on how happy that country is relative to the rest of the world.

```{r}
# Now, we need to compute the residual (i.e. the difference between the overall happiness score and the sum of the defined contributing factors) for each country for each year. We will use mutate and several transformation verbs to do this. Recall that .x implies 2018 and .y implies 2019 data.
happiness <- happiness %>% mutate(Residual.x = Score.x - (as.numeric(GDP.per.capita.x) + as.numeric(Social.support.x) + as.numeric(Healthy.life.expectancy.x) + as.numeric(Freedom.to.make.life.choices.x) + as.numeric(Generosity.x) + as.numeric(levels(Perceptions.of.corruption.x))[Perceptions.of.corruption.x]))
happiness <- happiness %>% mutate(Residual.y = Score.y - (as.numeric(GDP.per.capita.y) + as.numeric(Social.support.y) + as.numeric(Healthy.life.expectancy.y) + as.numeric(Freedom.to.make.life.choices.y) + as.numeric(Generosity.y) + as.numeric(Perceptions.of.corruption.y)))
# Select some variables and check that it worked
happiness %>% select(Country.or.region, Continent, Score.x, Score.y, Residual.x, Residual.y)
```

```{r}
# Let's start with 2018 and see what countries had the highest residual values.
happiness %>% arrange(desc(Residual.x)) %>% select(Country.or.region, Residual.x, Continent, Score.x)
```


## Data Visualization











